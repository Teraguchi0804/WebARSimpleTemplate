var ARjs=ARjs||{},THREEx=THREEx||{};ARjs.MarkerControls=THREEx.ArMarkerControls=function(t,r,e){function a(t){if(void 0!==t)for(var r in t){var e=t[r];if(void 0!==e){var a=o.parameters[r];void 0!==a&&(o.parameters[r]=e)}}}var o=this;THREEx.ArBaseControls.call(this,r),this.context=t,this.parameters={size:1,type:"unknown",patternUrl:null,barcodeValue:null,changeMatrixMode:"modelViewMatrix",minConfidence:.6};this.object3d=r,this.object3d.matrixAutoUpdate=!1,this.object3d.visible=!1,a(e),t.addMarker(this),"artoolkit"===o.context.parameters.trackingBackend?this._initArtoolkit():"aruco"===o.context.parameters.trackingBackend?this._arucoPosit=new POS.Posit(this.parameters.size,o.context.arucoContext.canvas.width):"tango"===o.context.parameters.trackingBackend&&this._initTango()},ARjs.MarkerControls.prototype=Object.create(THREEx.ArBaseControls.prototype),ARjs.MarkerControls.prototype.constructor=THREEx.ArMarkerControls,ARjs.MarkerControls.prototype.dispose=function(){this.context.removeMarker(this)},ARjs.MarkerControls.prototype.updateWithModelViewMatrix=function(t){var r=this.object3d;if(r.visible=!0,"artoolkit"===this.context.parameters.trackingBackend){var e=(new THREE.Matrix4).copy(this.context._artoolkitProjectionAxisTransformMatrix);e.multiply(t),t.copy(e)}else"aruco"===this.context.parameters.trackingBackend||"tango"===this.context.parameters.trackingBackend;if("tango"!==this.context.parameters.trackingBackend){var a=(new THREE.Matrix4).makeRotationX(Math.PI/2);t.multiply(a)}"modelViewMatrix"===this.parameters.changeMatrixMode?r.matrix.copy(t):"cameraTransformMatrix"===this.parameters.changeMatrixMode&&r.matrix.getInverse(t),r.matrix.decompose(r.position,r.quaternion,r.scale),this.dispatchEvent({type:"markerFound"})},ARjs.MarkerControls.prototype.name=function(){var t="";if(t+=this.parameters.type,"pattern"===this.parameters.type){var r=this.parameters.patternUrl,e=r.replace(/^.*\//g,"");t+=" - "+e}else"barcode"===this.parameters.type&&(t+=" - "+this.parameters.barcodeValue);return t},ARjs.MarkerControls.prototype._initArtoolkit=function(){function t(){var t=e.context.arController;"pattern"===e.parameters.type?t.loadMarker(e.parameters.patternUrl,function(r){a=r,t.trackPatternMarkerId(a,e.parameters.size)}):"barcode"===e.parameters.type?(a=e.parameters.barcodeValue,t.trackBarcodeMarkerId(a,e.parameters.size)):"unknown"===e.parameters.type&&(a=null),t.addEventListener("getMarker",function(t){if(t.data.type===artoolkit.PATTERN_MARKER&&"pattern"===e.parameters.type){if(null===a)return;t.data.marker.idPatt===a&&r(t)}else if(t.data.type===artoolkit.BARCODE_MARKER&&"barcode"===e.parameters.type){if(null===a)return;t.data.marker.idMatrix===a&&r(t)}else t.data.type===artoolkit.UNKNOWN_MARKER&&"unknown"===e.parameters.type&&r(t)})}function r(t){if(!(t.data.type===artoolkit.PATTERN_MARKER&&t.data.marker.cfPatt<e.parameters.minConfidence||t.data.type===artoolkit.BARCODE_MARKER&&t.data.marker.cfMatt<e.parameters.minConfidence)){var r=(new THREE.Matrix4).fromArray(t.data.matrix);e.updateWithModelViewMatrix(r)}}var e=this,a=null,o=setInterval(function(){var r=e.context.arController;null!==r&&(clearInterval(o),o=null,t())},20)},ARjs.MarkerControls.prototype._initAruco=function(){this._arucoPosit=new POS.Posit(this.parameters.size,_this.context.arucoContext.canvas.width)},ARjs.MarkerControls.prototype._initTango=function(){};